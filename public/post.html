<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Post</title>
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>
  <p><a href="posts-simple.html">← Back to posts</a></p>
  <h1 id="title">Loading…</h1>
  <div id="content" class="post-content"></div>

  <script>
    // Parse ?id=... from the query string
    const params = new URLSearchParams(location.search);
    const id = params.get('id');

    const titleEl = document.getElementById('title');
    const contentEl = document.getElementById('content');

    if (!id) {
      titleEl.textContent = 'Missing id';
      contentEl.innerHTML = '<div class="error">Use <code>post.html?id=POST_ID</code> or open from the list page.</div>';
    } else {
      const SAME_PORT = location.port === '3000';
      const API_BASE = SAME_PORT ? '' : `${location.protocol}//${location.hostname}:3000`;
      const URL = `${API_BASE}/api/posts/${encodeURIComponent(id)}`;

      async function load() {
        titleEl.textContent = 'Loading…';
        contentEl.textContent = '';
        try {
          const res = await fetch(URL, { headers: { 'Accept': 'application/json' } });
          if (!res.ok) {
            let msg = `HTTP ${res.status}`;
            try { const j = await res.json(); if (j && j.error) msg += ` - ${j.error}`; } catch { }
            if (res.status === 404) {
              titleEl.textContent = 'Post not found';
              contentEl.innerHTML = `<div class='error'>No post found for id <code>${id}</code>.<br><a href='posts-simple.html'>Go back to the list</a></div>`;
              return;
            }
            throw new Error(msg);
          }
          const data = await res.json();
          const p = data.data;
          titleEl.textContent = p.title;
          contentEl.innerHTML = `<p>${p.body}</p>`;
        } catch (err) {
          titleEl.textContent = 'Error';
          contentEl.innerHTML = `<div class='error'>Failed to load post.<br>${err.message}<br><small>Is the API running on port 3000?</small></div>`;
        }
      }

      load();
    }
  </script>
</body>

</html>